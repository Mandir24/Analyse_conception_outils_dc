{% extends "base.html" %}

{% block title %}Accueil - World-Univ-Rank{% endblock %}

{% block content %}
<div class="page-header">
    <div class="container">
        <h1><i class="bi bi-mortarboard-fill me-2"></i>Classement THE {{ annee_recente }}</h1>
        <p class="lead">Analyse mondiale de la performance universitaire et de ses déterminants socio-économiques</p>
    </div>
</div>


<div class="container my-5">

    <section class="mb-5">
        <div class="row align-items-center border-bottom pb-2 mb-4">
            <div class="col">
                <h2 class="text-secondary mb-0"><i class="bi bi-speedometer2 me-2"></i> Indicateurs Clés de Performance</h2>
            </div>
            <div class="col-auto">
                <div class="bg-white border rounded shadow-sm px-3 py-1">
                    <form action="{{ url_for('index') }}" method="get" class="d-flex align-items-center gap-2">
                        <label for="annee" class="fw-bold text-dark small text-uppercase mb-0">Année :</label>
                        <select name="annee" id="annee" class="form-select form-select-sm border-0 fw-bold text-primary shadow-none p-0" onchange="this.form.submit()" style="width: auto; cursor: pointer; background: none;">
                            {% for a in annees %}
                            <option value="{{ a }}" {% if a == annee_recente %}selected{% endif %}>{{ a }}</option>
                            {% endfor %}
                        </select>
                        <i class="bi bi-chevron-down small text-dark"></i>
                    </form>
                </div>
            </div>
        </div>
        
        <div class="row g-3 mb-4">
            <div class="col-md-4 col-lg-2">
                <div class="card h-100 shadow-sm border-0 text-center p-2 bg-light">
                    <div class="h4 fw-bold mb-0">{{ nb_pays }}</div>
                    <small class="text-muted text-uppercase x-small" style="font-size: 0.65rem;">Pays Représentés</small>
                </div>
            </div>
            <div class="col-md-4 col-lg-2">
                <div class="card h-100 shadow-sm border-0 text-center p-2 bg-light border-bottom border-danger border-3">
                    <div class="h4 fw-bold mb-0 text-truncate">{{ "{:,.0f}".format(pib_moyen) }}$</div>
                    <small class="text-muted text-uppercase x-small" style="font-size: 0.65rem;">PIB/hab Moyen</small>
                </div>
            </div>
            <div class="col-md-4 col-lg-2">
                <div class="card h-100 shadow-sm border-0 text-center p-2 bg-light border-bottom border-dark border-3">
                    <div class="h4 fw-bold mb-0">{{ alpha_moyen }}%</div>
                    <small class="text-muted text-uppercase x-small" style="font-size: 0.65rem;">Alphabétisation</small>
                </div>
            </div>
            <div class="col-md-4 col-lg-2">
                <div class="card h-100 shadow-sm border-0 text-center p-2 bg-light border-bottom border-secondary border-3">
                    <div class="h4 fw-bold mb-0">{{ migration_moy }}</div>
                    <small class="text-muted text-uppercase x-small" style="font-size: 0.65rem;">Migration Nette</small>
                </div>
            </div>
            <div class="col-md-4 col-lg-2">
                <div class="card h-100 shadow-sm border-0 text-center p-2 bg-light border-bottom border-info border-3">
                    <div class="h4 fw-bold mb-0 text-truncate" style="font-size: 1rem;">{{ pays_top_univ }}</div>
                    <small class="text-muted text-uppercase x-small" style="font-size: 0.65rem;">Top Pays ({{ pays_top_univ_nb }} u.)</small>
                </div>
            </div>
            <div class="col-md-4 col-lg-2">
                <div class="card h-100 shadow-sm border-0 text-center p-2 bg-light">
                    <div class="h4 fw-bold mb-0 text-truncate" style="font-size: 1rem;">{{ region_top_univ }}</div>
                    <small class="text-muted text-uppercase x-small" style="font-size: 0.65rem;">Top Région ({{ region_top_univ_nb }} u.)</small>
                </div>
            </div>
        </div>

        <div class="row g-3">
            <div class="col-md-4 col-lg-2">
                <div class="card h-100 shadow-sm border-0 text-center p-2 border-bottom border-primary border-4">
                    <div class="h4 fw-bold text-primary mb-0">{{ nb_universites }}</div>
                    <small class="text-muted text-uppercase x-small" style="font-size: 0.65rem;">Total Universités</small>
                </div>
            </div>
            <div class="col-md-4 col-lg-2">
                <div class="card h-100 shadow-sm border-0 text-center p-2 border-bottom border-dark border-4">
                    <div class="h4 fw-bold text-dark mb-0">{{ score_moyen }}</div>
                    <small class="text-muted text-uppercase x-small" style="font-size: 0.65rem;">Score Global</small>
                </div>
            </div>
            <div class="col-md-4 col-lg-2">
                <div class="card h-100 shadow-sm border-0 text-center p-2 border-bottom border-info border-4">
                    <div class="h4 fw-bold text-info mb-0">{{ enseig_moyen }}</div>
                    <small class="text-muted text-uppercase x-small" style="font-size: 0.65rem;">Score Enseignement</small>
                </div>
            </div>
            <div class="col-md-4 col-lg-2">
                <div class="card h-100 shadow-sm border-0 text-center p-2 border-bottom border-success border-4">
                    <div class="h4 fw-bold text-success mb-0">{{ rech_moyen }}</div>
                    <small class="text-muted text-uppercase x-small" style="font-size: 0.65rem;">Score Recherche</small>
                </div>
            </div>
            <div class="col-md-4 col-lg-2">
                <div class="card h-100 shadow-sm border-0 text-center p-2 border-bottom border-warning border-4">
                    <div class="h4 fw-bold text-warning mb-0">{{ ratio_fh_moyen }}%</div>
                    <small class="text-muted text-uppercase x-small" style="font-size: 0.65rem;">Ratio moyen F/H</small>
                </div>
            </div>
            <div class="col-md-4 col-lg-2">
                <div class="card h-100 shadow-sm border-0 text-center p-2 border-bottom border-secondary border-4">
                    <div class="h4 fw-bold text-secondary mb-0">{{ etud_inter_moyen }}%</div>
                    <small class="text-muted text-uppercase x-small" style="font-size: 0.65rem;">Etud. Internationaux</small>
                </div>
            </div>
        </div>
    </section>

    <section class="mb-5">
        <div class="row g-4">
            <div class="col-lg-6">
                <div class="card shadow-sm h-100">
                    <div class="card-header bg-info text-white py-3">
                        <h5 class="mb-0"><i class="bi bi-award me-2"></i> Top 5 Pays - Enseignement</h5>

                    </div>
                    <div class="card-body">
                        <canvas id="chartTopEns"></canvas>
                        <div class="mt-3 p-3 bg-light rounded border-start border-4 border-info">
                            <p class="small mb-0 text-muted italic">
                                <strong>Analyse :</strong> Ce graphique identifie les nations possédant les meilleurs systèmes d’enseignement universitaire. Ces pays affichent généralement des scores élevés grâce à des ratios encadrement/étudiants optimaux.
                            </p>
                        </div>
                    </div>
                </div>
            </div>

            <div class="col-lg-6">
                <div class="card shadow-sm h-100">
                    <div class="card-header bg-success text-white py-3">
                        <h5 class="mb-0"><i class="bi bi-award me-2"></i>Top 5 Pays — Recherche</h5>

                    </div>
                    <div class="card-body">
                        <canvas id="chartTopRech"></canvas>
                        <div class="mt-3 p-3 bg-light rounded border-start border-4 border-success">
                            <p class="small mb-0 text-muted italic">
                                <strong>Analyse :</strong> Les pays leaders en enseignement confirment-ils leur rang en recherche ? On constate une forte corrélation entre les deux piliers, validant l'excellence académique globale.
                            </p>
                        </div>
                    </div>
                </div>
            </div>

                <h2 class="border-bottom pb-2 mb-4 text-secondary">
                    <i class="bi bi-globe-central-south-asia me-2"></i> Répartition des Universités par Région
                </h2>
            <div class="col-lg-12">
                <div class="card shadow-sm">
                    <div class="card-body p-4">
                        <div class="row align-items-center">
                            <div class="col-md-7 text-center">
                                
                                <div style="max-height: 300px;">
                                    <canvas id="chartRegion"></canvas>
                                </div>
                            </div>
                            <div class="col-md-5 border-start">
                                <div class="ps-md-4">
                                    <h6 class="fw-bold text-secondary text-uppercase small">Distribution Géographique</h6>
                                    <p class="small text-muted">
                                        Ce diagramme circulaire représente les régions les plus représentées au sein du classement mondial. 
                                        L'Europe et l'Asie-Pacifique dominent en nombre d'institutions, illustrant la concentration des pôles de savoir.
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <section class="mb-5">
        <h2 class="border-bottom pb-2 mb-4 text-secondary">
            <i class="bi bi-trophy me-2"></i> Élite Mondiale : Le Top 10 ({{ annee_recente }})
        </h2>

        <div class="table-responsive shadow-sm rounded">
            <table class="table table-striped table-hover result-table mb-0">
                <thead style="background-color: #2c3e50; color: white;">
                    <tr>
                        <th style="width: 8%;">Rang</th>
                        <th>Université</th>
                        <th>Pays</th>
                        <th>Région</th>
                        <th class="text-center">Enseignement</th>
                        <th class="text-center">Recherche</th>
                        <th class="text-center">Score Global</th>
                        <th class="text-end pe-4">Action</th>
                    </tr>
                </thead>
                <tbody>
                    {% for univ in top_10 %}
                    <tr>
                        <td>
                            {% if univ.rang == 1 %}<span class="badge badge-rank-1">1</span>
                            {% elif univ.rang == 2 %}<span class="badge badge-rank-2">2</span>
                            {% elif univ.rang == 3 %}<span class="badge badge-rank-3">3</span>
                            {% else %}<span class="badge bg-dark">{{ univ.rang }}</span>{% endif %}
                        </td>
                        <td class="fw-bold">{{ univ.universite.nom_univ }}</td>
                        <td>{{ univ.universite.pays.nom_pays }}</td>
                        <td><span class="text-muted small text-uppercase">{{ univ.universite.pays.region.nom_region }}</span></td>
                        <td class="text-center">
                            <span class="badge rounded-pill bg-info">{{ univ.indic_enseig | round(1) }}</span>
                        </td>
                        <td class="text-center">
                            <span class="badge rounded-pill bg-success">{{ univ.indic_qualite_rech | round(1) }}</span>
                        </td>
                        <td class="text-center">
                            <span class="badge rounded-pill bg-primary">{{ univ.score_global | round(1) }}</span>
                        </td>
                        <td class="text-end pe-4">
                            <a href="{{ url_for('fiche_universite', id=univ.id_classement) }}" class="btn btn-sm btn-outline-dark">
                                <i class="bi bi-eye"></i> Détails
                            </a>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </section>
</div>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener("DOMContentLoaded", function () {
    const topEns = {{ data_top_pays_enseig | tojson | default({}) | safe }};
    const topRech = {{ data_top_pays_rech | tojson | default({}) | safe }};
    const regions = {{ data_repartition_region | tojson | default({}) | safe }};

    if (topEns.labels && topEns.labels.length) {
        createHorizontalBarChart("chartTopEns", topEns.labels, topEns.data, chartColors.info, "Score enseignement");
    }

    if (topRech.labels && topRech.labels.length) {
        createHorizontalBarChart("chartTopRech", topRech.labels, topRech.data, chartColors.success, "Score recherche");
    }

    if (regions.labels && regions.labels.length) {
        createPieOrDoughnutChart("chartRegion", regions.labels, regions.data, true, "Nb universités");
    }
});
</script>
{% endblock %}